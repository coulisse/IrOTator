<html>
    <head>
    <title>WebSocket Echo Test</title>
    <!-- Essential JS UI widget -->
    <script src="gauge.min.js"></script>
    <script>

    if (!Array.prototype.forEach) {
        Array.prototype.forEach = function(cb) {
            var i = 0, s = this.length;
            for (; i < s; i++) {
                cb && cb(this[i], i, this);
            }
        }
    }
    document.fonts && document.fonts.forEach(function(font) {
        font.loaded.then(function() {
            if (font.family.match(/Led/)) {
                document.gauges.forEach(function(gauge) {
                    gauge.update();
                });
            }
        });
    });
        function init() { 
        websocket = new WebSocket("ws://192.168.1.73:81/");
        
        websocket.onopen = function() { 
            document.getElementById("output").innerHTML += "<p>> CONNECTED</p>"; 
        };
        
        <!-- getting responses from server -->
        websocket.onmessage = function(evt) { 
            var obj = JSON.parse(evt.data);
            
            switch(obj.c) {
                case "getCompass":    
                document.getElementById("getCompass").innerHTML = "<p style='color: blue;'>" +  obj.v + "</p>";     
                document.gauges.forEach(function(gauge) {
                    gauge.value = parseFloat(
                obj.v) || 0;
            setTimeout(function() {
                console.log('new gauge value:' + gauge.value);
            }, 1510);
                });
                break;

                case "setCompass":                        
                    document.getElementById("setCompass").innerHTML = "<p style='color: blue;'>" +  obj.v + "</p>";                                          
                    break;

                case "leftRotator":  
                    document.getElementById("leftRotator").innerHTML = "<p style='color: blue;'>"   + obj.v + "</p>";                          
                    break;

                case "rightRotator":                        
                    document.getElementById("rightRotator").innerHTML = "<p style='color: blue;'> "  + obj.v + "</p>";                          
                    break;

                case "stopRotator":                        
                    document.getElementById("stopRotator").innerHTML = "<p style='color: blue;'>  " + obj.v + "</p>";                          
                    break;

                case "standBy":                        
                    document.getElementById("standBy").innerHTML = "<p style='color: blue;'>"  + obj.v + "</p>";                          
                    break;

                case "reset":                        
                    document.getElementById("reset").innerHTML = "<p style='color: blue;'>"  + obj.v + "</p>";                          
                    break;

                default:
                   
            }

        };
        
        websocket.onerror = function(evt) { document.getElementById("output").innerHTML += "<p style='color: red;'>> ERROR: " + evt.data + "</p>"; };
        }
        
        function getCompass() {
            message='{"c":"getCompass","v":"","r":""}'
            websocket.send(message);
        }

        function setCompass(degree) {
            message='{"c":"setCompass","v":"'+degree+'","r":""}'
            websocket.send(message);
        }

        function sendMessage(message) {
        document.getElementById("output").innerHTML = "<p>> SENT: " + message + "</p>";
        
        websocket.send(message);
        }
        
        window.addEventListener("load", init, false);
    </script>
</head>
<body>
    <p>{"c":"getCompass","v":"valore","r":"return code"}</p>
    <input onkeypress="if(this.value) {if (window.event.keyCode == 13) { sendMessage(this.value); this.value = null; }}"/>   
    
    <!--    <input onkeypress="if(this.value) {if (window.event.keyCode == 13) { setCompass(100); this.value = null; }}"/> -->
    <div id="output"></div>
    <table style="width:100%">
      <tr>
        <th >getCompass</th>
        <th >setCompass</th> 
        <th >leftRotator</th>
        <th >rightRotator</th>
        <th >stopRotator</th>
        <th >standBy</th>
        <th >reset</th>
      </tr>
      <tr>
        <td id="getCompass"></td>
        <td id="setCompass"></td>
        <td id="leftRotator"></td>
        <td id="rightRotator"></td>
        <td id="stopRotator"></td>
        <td id="standBy"></td>
        <td id="reset"></td>
      </tr>
    </table>
    

<canvas data-type="radial-gauge"
        data-width="500"
        data-height="500"
        data-min-value="0"
        data-max-value="360"
        data-major-ticks="N,NE,E,SE,S,SW,W,NW,N"
        data-minor-ticks="22"
        data-ticks-angle="360"
        data-start-angle="180"
        data-stroke-ticks="false"
        data-highlights="false"
        data-color-plate="#33a"
        data-color-major-ticks="#f5f5f5"
        data-color-minor-ticks="#ddd"
        data-color-numbers="#ccc"
        data-color-needle="rgba(240, 128, 128, 1)"
        data-color-needle-end="rgba(255, 160, 122, .9)"
        data-value-box="true"
        data-animated-value="true"
        data-value-text-shadow="false"
        data-color-circle-inner="#fff"
        data-color-needle-circle-outer="#ccc"
        data-needle-circle-size="15"
        data-needle-circle-outer="false"
        data-animation-rule="linear"
        data-needle-type="line"
        data-needle-start="75"
        data-needle-end="99"
        data-needle-width="3"
        data-borders="true"
        data-border-inner-width="0"
        data-border-middle-width="0"
        data-border-outer-width="10"
        data-color-border-outer="#ccc"
        data-color-border-outer-end="#ccc"
        data-color-needle-shadow-down="#222"
        data-border-shadow-width="0"
        data-animation-target="needle"
        data-units="ᵍ"
        data-title="DIRECTION"
        data-font-title-size="19"
        data-color-title="#f5f5f5"
        data-animation-duration="1500"
        data-value="5"
        data-animate-on-init="true"
        data-use-min-path="true"
></canvas>

<canvas data-type="radial-gauge"
    data-min-value="0"
    data-max-value="360"
    data-major-ticks="N,NE,E,SE,S,SW,W,NW,N"
    data-minor-ticks="22"
    data-ticks-angle="360"
    data-start-angle="180"
    data-stroke-ticks="false"
    data-highlights="false"
    data-color-plate="#222"
    data-color-major-ticks="#f5f5f5"
    data-color-minor-ticks="#ddd"
    data-color-numbers="#ccc"
    data-color-needle="rgba(240, 128, 128, 1)"
    data-color-needle-end="rgba(255, 160, 122, .9)"
    data-value-box="false"
    data-value-text-shadow="false"
    data-color-circle-inner="#fff"
    data-color-needle-circle-outer="#ccc"
    data-needle-circle-size="15"
    data-needle-circle-outer="false"
    data-animation-rule="linear"
    data-needle-type="line"
    data-needle-start="75"
    data-needle-end="99"
    data-needle-width="3"
    data-borders="true"
    data-border-inner-width="0"
    data-border-middle-width="0"
    data-border-outer-width="10"
    data-color-border-outer="#ccc"
    data-color-border-outer-end="#ccc"
    data-color-needle-shadow-down="#222"
    data-border-shadow-width="0"
    data-animation-duration="1500"
></canvas>

</body>
</html>